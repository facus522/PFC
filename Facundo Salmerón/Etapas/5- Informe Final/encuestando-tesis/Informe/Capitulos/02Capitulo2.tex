%---------------------------------------------------------------------
%
%                          Capítulo 4
%
%---------------------------------------------------------------------
\lstset{
	escapeinside={<@}{@>},
	frame = single, 
	language=Java}
\definecolor{mygray}{RGB}{118, 118, 118}
\definecolor{myblue}{RGB}{27, 6, 215}
\definecolor{mypurple}{RGB}{128, 75, 119}
\def\graycolor{\color{mygray}}
\def\blackcolor{\color{black}}
\def\bluecolor{\color{myblue}}
\def\purplecolor{\color{mypurple}}

\chapter{Diseño y desarrollo de la aplicación móvil}

\begin{resumen}
	En este capítulo se describen todos los aspectos relacionados al diseño y desarrollo de la aplicación en cuestión. Se desarrollará un análisis de Android, en el cual se describirán todas las características y estructura del proyecto.
	\\
	Se presentará el desarrollo realizado para llevar adelante la solución del problema principal, junto a todas las APIs y bibliotecas utilizadas en conjunto.
\end{resumen}


%-------------------------------------------------------------------
\section{Proyecto Android}
%-------------------------------------------------------------------
\label{cap4:sec:nociones-android}

Tal como fue especificado anteriormente, el desarrollo de la aplicación móvil fue llevado a cabo bajo el IDE Android Studio. Para ello, es importante describir todas las cuestiones relacionadas a un proyecto Android, con la finalidad de comprender la estructura que el mismo presenta, todos los componentes básicos, ciclos de vida, comunicación con el Web Service, entre otras cosas.

%------------------------------------------------------------------
\subsection{Componentes básicos de una aplicación Android}
%-------------------------------------------------------------------
\label{cap4:subsec:componentes-android}

Es de suma importancia comprender cuáles son los distintos componentes que se pueden encontrar en una aplicación Android típica, para luego tener un mejor análisis de la estructura que conlleva un proyecto de dicho lenguaje.
\\

Los componentes de la aplicación son bloques de creación esenciales de una aplicación para Android. Cada componente es un punto diferente a través del cual el sistema puede ingresar a la aplicación. No todos los componentes son puntos de entrada reales para el usuario y algunos son dependientes entre sí, pero cada uno existe como entidad individual y cumple un rol específico; cada uno es un bloque de creación único que ayuda a definir el comportamiento general de tu aplicación \cite{componentesAndroid}.
\\

Hay cuatro tipos diferentes de componentes de una aplicación. Cada tipo tiene un fin específico y un ciclo de vida diferente que define cómo se crea y se destruye el componente:

\begin{itemize}
	
	\item \textbf{\textit{Activities}}: una activity representa una pantalla con interfaz de usuario. Cada una de ellas tiene asignada una ventana en la cual se representa la interfaz gráfica. Para llevar adelante la construcción de la interfaz, existen componentes denominados vistas (Views) con los que se dispone de numerosos controles básicos, como por ejemplo botones, cuadros de texto, imágenes, etc.
	
	Una aplicación está formada por diversos activities, los cuales se encuentran interactuando entre sí. Existe una actividad principal (definida en el manifest como se verá más adelante), que se encarga de iniciar la aplicación.
	
	Para crear una nueva actividad, se debe crear una nueva clase Java, que hereda de \textit{Activity}, definiendo así su propia interfaz de usuario y las funcionalidades pertinentes.
	
	\item \textbf{\textit{Services}}: un servicio es un componente que se ejecuta en segundo plano para realizar operaciones prolongadas o tareas para procesos remotos. Un servicio no proporciona una interfaz de usuario. Son llamados a través de otro componente, como puede ser una Activity, y seguirán ejecutándose en segundo plano aunque la misma haya finalizado
	
	\item \textbf{\textit{Content Providers}}: es un componente destinado a compartir datos entre aplicaciones. Dichos datos pueden ser almacenados en el sistema de archivos, en una base de datos SQLite o en cualquier otro lugar que sea accesible desde la aplicación.
	
	\item \textbf{\textit{Broadcast Receiver}}: es un componente que detecta y reacciona frente a mensajes globales del sistema, como puede ser batería baja, SMS recibido, llamada perdida, etc. Además de esto, las aplicaciones también pueden iniciar mensajes; por ejemplo, para permitir que otras aplicaciones sepan que se descargaron datos al dispositivo y están disponibles para usarlos. Si bien no exhiben una interfaz de usuario, pueden crear una notificación de la barra de estado para alertar al usuario cuando se produzca un evento de mensaje.
	
\end{itemize}


%------------------------------------------------------------------
\subsection{Estructura del proyecto}
%-------------------------------------------------------------------
\label{cap4:subsec:estructura-android}

Un proyecto desarrollado en Android Studio está formado por distintos directorios, los cuales contienen recursos que se utilizarán a medida que se va desarrollando la aplicación. Dentro de las características principales que posee, se realiza una modularización en directorios y utiliza el lenguaje de programación XML, evitando de esta forma el exceso de código inútil en los ficheros Java.
\\

Tal como se puede ver en la Figura \ref{fig:estructura_proyecto}, inicialmente nos encontramos con un archivo de configuración XML denominado \textit{AndroidManifest}. Se encuentra situado en la raíz de todos los proyectos, y sirve para aplicar configuraciones básicas en la aplicación. El sistema Android accede a él antes de compilar cualquier línea de código \cite{manifest}. Dentro de las configuraciones que contiene se destacan:

\begin{itemize}
	
	\item Nombre del paquete de la aplicación, para identificarla de manera única.
	
	\item Definición de componentes como Activities, Services, Content, Providers, etc.
	
	\item Activity principal al iniciar.
	
	\item Nivel mínimo de la API que Android requiere para la aplicación.
	
	\item Nombre e ícono de la aplicación.
	
	\item Permisos que necesita la app para realizar determinadas tareas. Como por ejemplo acceder a la ubicación, internet, etc.
	
\end{itemize}

\begin{figure}[h!]
	\begin{center}
		\includegraphics[width=1\textwidth]%
		{Imagenes/Bitmap/estructuraAndroid}
		\caption{Estructura de proyecto Android}
		\label{fig:estructura_proyecto}
	\end{center}
\end{figure}

A continuación del manifest se sitúa el directorio \textit{Java}. Esta carpeta, que a su vez puede ser subdividida en distintos paquetes y subdirectorios, contiene todo el código fuente de la aplicación, activities, clases auxiliares, enumerables, interfaces, tests unitarios, etc. Inicialmente, Android Studio crea automáticamente el código básico de la pantalla principal de la aplicación, es decir el \textit{MainActivity}, que se ejecuta cuando la aplicación inicia.
\\

Luego nos encontramos con el directorio \textit{res}, es decir los recursos. Como lo dice su nombre, contiene todos los ficheros de recursos necesarios para el proyecto como imágenes, layouts, cadenas de texto, etc. Al igual que en el caso anterior, es subdividido en distintos subdirectorios, en los que se destacan los siguientes \cite{estructuraAndroid}:

\begin{itemize}
	
	\item \textbf{\textit{Drawable}}: contiene todas las imágenes y elementos gráficos utilizados por la aplicación. Para poder definir diferentes recursos dependiendo de la resolución y densidad de la pantalla del dispositivo, se encuentran varios directorios dentro de drawable.
	
	\item \textbf{\textit{Mipmap}}: contiene los íconos de la aplicación y al igual que en el caso anterior, se divide en subdirectorios de acuerdo a la resolución y densidad de pantalla. 
	
	\item \textbf{\textit{Layout}}: contiene los archivos XML relacionados a los Activities Java para la definición de la interfaz gráfica. 
	
	\item \textbf{\textit{Values}}: contiene otros archivos XML de importancia para la aplicación en los que se pueden definir todo tipo de valores, como por ejemplo cadenas de texto (\textit{strings.xml}), estilos (\textit{styles.xml}), colores (\textit{colours.xml}), etc. Estos valores luego pueden ser llamados desde cualquier punto de la aplicación, utilizando siempre el mismo recurso, sin necesidad de volver a redefinirlo cada vez que se lo requiera. Y si se desea realizar un cambio sobre alguno de ellos, simplemente se modifica el recurso de la carpeta value y el cambio se replica en toda la aplicación.
	
	Por ejemplo, en la aplicación del proyecto se definió un estándar para un tipo de botón. Por lo tanto en el archivo \textit{colours.xml} se definió:
	\\
	\begin{lstlisting}[escapechar=¿]
		<color ¿\aftergroup\purplecolor¿name¿\aftergroup\blackcolor¿=¿\aftergroup\bluecolor¿"mainButtonColor"¿\aftergroup\blackcolor¿>¿\aftergroup\graycolor¿#3646c1¿\aftergroup\blackcolor¿</color>
	\end{lstlisting}
	
	Entonces, cada vez que se requería colocar dicho color en un botón de la aplicación (o donde fuera necesario), simplemente se llamaba por su nombre y se aplicaba.
\end{itemize}

Finalmente se encuentran los parámetros de configuración de Gradle. Gradle básicamente es una herramienta de automatización para la construcción del proyecto, similar a Maven (herramienta utilizada en el desarrollo del Web Service). En dichos archivos, se encuentra la información necesaria para la compilación del proyecto, por ejemplo la versión del SDK de Android utilizada para compilar, la mínima versión de Android que soportará la aplicación, referencias a librerías externas utilizadas, el número de versión de la app, etc.
\\

En un proyecto pueden existir varios ficheros build.gradle, para definir determinados parámetros a distintos niveles. En este caso, podemos ver que existe un fichero build.gradle a nivel de proyecto, y otro a nivel de módulo dentro de la carpeta /app. El primero de ellos definirá parámetros globales a todos los módulos del proyecto, y el segundo sólo tendrá efecto para cada módulo en particular.
\\

Como se puede ver en la Figura \ref{fig:conf-sdk}, se establece la primer versión de la aplicación móvil, junto con la definición del SDK Android utilizado para compilar en la versión 26, correspondiente con Android 7.0 Nogaut. La versión mínima de SDK que soportará será la 19, tal como se mencionó anteriormente, se corresponde con Android 4.4 KitKat.

\begin{figure}[h!]
	\begin{center}
		\includegraphics[width=1\textwidth]%
		{Imagenes/Bitmap/gradle1}
		\caption{Configuración SDK}
		\label{fig:conf-sdk}
	\end{center}
\end{figure}

A su vez, como se visualiza en la Figura \ref{fig:conf-librerias}, se encuentran todas las dependencias correspondientes a librerías externas, que se encargan de complementar el proyecto y lograr el alcance esperado. Por ejemplo, se encuentran las dependencias relacionadas para el API de Google Maps, Firebase, OpenCsv, etc.

\begin{figure}[h!]
	\begin{center}
		\includegraphics[width=1\textwidth]%
		{Imagenes/Bitmap/gradle2}
		\caption{Librerías externas utilizadas}
		\label{fig:conf-librerias}
	\end{center}
\end{figure}

\newpage
\thispagestyle{empty}
\mbox{ }